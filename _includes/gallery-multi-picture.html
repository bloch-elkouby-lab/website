{% assign carousel_id = 'carousel-' | append: include.title | slugify %}

<div class="gallery-column-item" style="flex: 1; min-width: 300px; max-width: 500px; margin: 10px;">
  <div class="gallery-picture" style="width: 100%; text-align: center;">
    
    <div id="{{ carousel_id }}" style="position: relative; overflow: hidden; border-radius: 8px; background: #f0f0f0; line-height: 0;">
      {% assign image_list = include.images | split: "," %}
      {% for img in image_list %}
        <img
          class="carousel-slide-{{ carousel_id }}"
          src="{{ img | strip | relative_url }}"
          loading="lazy"
          style="width: 100%; aspect-ratio: 4/3; object-fit: cover; display: none;"
          {% include fallback.html %}
        >
      {% endfor %}

      {% if image_list.size > 1 %}
        <button class="carousel-btn prev" onclick="plusSlides('{{ carousel_id }}', -1)">&#10094;</button>
        <button class="carousel-btn next" onclick="plusSlides('{{ carousel_id }}', 1)">&#10095;</button>
      {% endif %}
    </div>

    <div class="gallery-caption" style="text-align: center; margin-top: 12px; width: 100%;">
        <p style="margin: 0; font-weight: bold; font-size: 1.1em; color: #333;">{{ include.title }}</p>
        {% if include.text %}
          <div style="font-size: 0.9em; color: #666; margin-top: 5px; line-height: 1.4;">
            {{ include.text | markdownify }}
          </div>
        {% endif %}
    </div>
  </div>
</div>

<style>
/* Scoped Styles for Carousel */
#{{ carousel_id }} .carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.4);
  color: white;
  border: none;
  padding: 12px 10px;
  cursor: pointer;
  z-index: 5;
  transition: 0.3s;
}
#{{ carousel_id }} .carousel-btn:hover { background: rgba(0,0,0,0.7); }
.prev { left: 0; border-radius: 0 4px 4px 0; }
.next { right: 0; border-radius: 4px 0 0 4px; }
</style>

<script>
// Logic to handle multiple carousels on one page
window.carouselState = window.carouselState || {};

function showSlides(id, n) {
  const container = document.getElementById(id);
  if (!container) return;
  const slides = container.querySelectorAll(".carousel-slide-" + id);
  if (!slides.length) return;

  if (!(id in window.carouselState)) window.carouselState[id] = 0;
  const total = slides.length;
  const index = (n + total) % total;

  slides.forEach((slide, i) => {
    slide.style.display = (i === index) ? "block" : "none";
  });
  window.carouselState[id] = index;
}

function plusSlides(id, delta) {
  showSlides(id, (window.carouselState[id] || 0) + delta);
}

// Auto-initialize when page loads
(function() {
  const init = () => { showSlides('{{ carousel_id }}', 0); };
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>